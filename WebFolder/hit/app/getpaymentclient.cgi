<!--HIT_EXECUTE

C_LONGINT(pJSONObject)C_REAL(pAmountReal)pJSONObject:=JSON New Object If (_HIT_AuthenticateSession ="Session-Authenticated-OK")QUERY([purchase_invoices];[purchase_invoices]id=Num(_HIT_WebApp_GetField ("purchase_inv_no")))JSON Set Text (pJSONObject;"purchase_inv_uuid";[purchase_invoices]uuid)pAmountReal:=String([purchase_invoices]payment_balance)+Char(Space)+[purchase_invoices]currency_codeJSON Set Text (pJSONObject;"Amount";pAmountReal)If ([purchase_invoices]purchase_invoice_status="Paid")JSON Set Text (pJSONObject;"paid";"Already paid")Else RELATE ONE([purchase_invoices]uuid_company)If (Records in selection([Companies])=1)JSON Set Text (pJSONObject;"CustomerUUID";[Companies]uuid)JSON Set Text (pJSONObject;"CustomerName";[Companies]company_Name)End if End ifElse JSON Set Text (pJSONObject;"error";"AUTH FAILED")End if Web_ResponseDataBLOB:=JSON Save As Blob (pJSONObject)If (JSON Is Valid Object (pJSONObject)=1)JSON Release (pJSONObject)End if _HIT_HTTPD_SetHTTPHeader ("Content-Type";"application/json")_HIT_HTTPD_AppendResponse (->Web_ResponseDataBLOB)
-->