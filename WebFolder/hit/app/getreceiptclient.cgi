<!--HIT_EXECUTE

C_LONGINT(mJSONObject)C_TEXT(pAmountStr)mJSONObject:=JSON New Object //If (_HIT_AuthenticateSession ="Session-Authenticated-OK")QUERY([Invoices];[Invoices]inv_number=Num(_HIT_WebApp_GetField ("inv_no")))If (Records in selection([Invoices])=0)JSON Set Text (mJSONObject;"invoiceuuid";"")Else If ([Invoices]invoice_status="Paid")JSON Set Text (mJSONObject;"paid";"Already paid")Else JSON Set Text (mJSONObject;"invoiceuuid";[Invoices]uuid)pAmountStr:=String([Invoices]balance_due)+Char(Space)+[Invoices]inv_currency_codeJSON Set Text (mJSONObject;"Amount";pAmountStr)RELATE ONE([Invoices]client_id)If (Records in selection([Companies])=1)JSON Set Text (mJSONObject;"CustomerID";[Companies]uuid)JSON Set Text (mJSONObject;"CustomerName";[Companies]company_Name)End ifEnd ifEnd if //Else//JSON Set Text (mJSONObject;"error";"AUTH FAILED")//End ifWeb_ResponseDataBLOB:=JSON Save As Blob (mJSONObject)If (JSON Is Valid Object (mJSONObject)=1)mJSONObject:=JSON New Object JSON Set Text (mJSONObject;"error";"Error, please contact support.")End if JSON Release (mJSONObject)_HIT_HTTPD_SetHTTPHeader ("Content-Type";"application/json")_HIT_HTTPD_AppendResponse (->Web_ResponseDataBLOB)
-->